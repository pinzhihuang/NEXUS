# Nixpacks configuration for Railway deployment
# Adds Chromium and required dependencies for headless browser

[phases.setup]
nixPkgs = ["...", "chromium"]

[phases.install]
cmds = [
  "echo '=== Verifying Chromium ==='",
  "which chromium || echo 'WARNING: chromium not in PATH'",
  "chromium --version || echo 'WARNING: chromium --version failed'",
  "echo '========================='",
]

[start]
cmd = "gunicorn app:app --bind 0.0.0.0:${PORT:-8080} --workers 2 --threads 2 --timeout 120 --access-logfile - --error-logfile - --log-level info"

[phases.install]
cmds = [
  "echo '=================================================='",
  "echo 'ðŸ” NIXPACKS BUILD - Verifying Chromium Installation'",
  "echo '=================================================='",
  "bash verify_build.sh || echo 'verify_build.sh not found or failed'",
  "echo '=================================================='",
  "echo 'Direct verification:'",
  "which chromium || echo 'WARNING: chromium not in PATH'",
  "chromium --version || echo 'WARNING: chromium --version failed'",
  "ls -la /nix/store/*/bin/chromium 2>/dev/null || echo 'WARNING: No chromium in /nix/store'",
  "find /nix/store -name chromium -type f -executable 2>/dev/null | head -5 || echo 'WARNING: find chromium failed'",
  "echo '=================================================='",
]

[start]
cmd = "bash start.sh"
